{% extends "base.html" %}

{% block title %}{{ program.program_name }} - Student Management{% endblock %}

{% block content %}
<div class="row mb-4 border-bottom border-white">
    <div class="col-md-10 p-2">
        <h1 class="text-white">{{ program.program_name }}</h1>
    </div>
    <div class="col-md-2 text-end p-2">
        <a href="{{ url_for('programs.list') }}" class="btn btn-lg btn-secondary btn-hover ">Back</a>
    </div>
</div>

<div class="border border-white rounded-4 p-3 text-white ">
    <div class="px-4 py-2 row">
        <h2 class="col-6">Information</h2>
        <div class="col-md-6 text-end">
            <a href="{{ url_for('programs.update', program_id=program.program_id)}}"
                class="btn btn-outline-warning rounded-4" type="button">Edit</a>
            <button class="btn btn-outline-danger rounded-4" onclick="deleteProgram('{{ program.program_id }}')"
                type="button">Delete</button>
        </div>
    </div>
    <hr class="border-bottom border-white m-2">
    <div class="px-4 py-2">
        <div>
            <p class="fw-bolder">Code : <span class="fw-normal">{{ program.program_id }}</span></p>
            <p class="fw-bolder">Department : <span class="fw-normal">{{ program.department }}</span></p>
            <p class="fw-bolder">Duration Years : <span class="fw-normal">{{ program.duration_years }}</span></p>
            <p class="fw-bolder">Degree Type : <span class="fw-normal">{{ program.degree_type }}</span></p>
        </div>
    </div>
    <hr class="border-bottom border-white m-2">
    <div class="px-4 py-2 row">
        <h2 class="col-6">Courses</h2>
        <div class="col-md-6 text-end">
            <button type="button" class="btn btn-primary rounded-4" data-bs-toggle="modal" data-bs-target="#AddModal">
                + Add
            </button>
        </div>
    </div>
    <div class="px-4">
        <div class="table-container border rounded-4">
            <table class="table table-striped table-hover text-center border rounded-4">
                <thead class="table-primary sticky-header">
                    <tr>
                        <th>Code</th>
                        <th>Course</th>
                        <th>Credit Hours</th>
                        <th>Semester Offered</th>
                        <th>Instructor ID</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% if course|length == 0 %}
                    <tr>
                        <td colspan="12" class="text-center text-muted">No Information</td>
                    </tr>
                    {% endif %}
                    {% for co in course %}
                    <tr>
                        <td>{{ co.course_id }}</td>
                        <td>{{ co.course_name }}</td>
                        <td>{{ co.credit_hours }}</td>
                        <td>{{ co.semester_offered }}</td>
                        <td>{{ co.instructor_name }}</td>
                        <td>
                            <button class="btn btn-outline-warning" id="#UpdateModal" data-bs-toggle="modal"
                                data-bs-target="#UpdateModal" data-bs-course-id="{{ co.course_id }}">
                                <i class="bi bi-pencil-square"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="deleteCourse('{{ co.course_id }}')">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>



<script>
    function deleteProgram(id) {
        if (confirm('Are you sure you want to delete this program?')) {
            fetch(`/programs/delete/${id}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.href = '{{ url_for("programs.list") }}';
                    } else {
                        alert(data.message);
                    }
                });
        }
    }
</script>

<script>
    function deleteCourse(id) {
        if (confirm('Are you sure you want to delete this course?')) {
            fetch(`/programs/deletecourse/${id}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.href = '{{ url_for("programs.get_by_id", program_id=program.program_id) }}';
                    } else {
                        alert(data.message);
                    }
                });
        }
    }
</script>

<!-- AddModal -->
<form method="POST" action="{{ url_for('programs.addcourse', program_id=program.program_id)}}">
    <div class="modal fade" id="AddModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Add Enrollment</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-floating mb-4">
                        <input type="text" class="form-control" id="floatingInput" name="course_name"
                            placeholder="name@example.com" required>
                        <label for="floatingInput">New Course Name</label>
                    </div>
                    <div class="form-floating mb-4">
                        <input type="number" class="form-control" id="floatingInput" name="credit_hours"
                            placeholder="name@example.com" required>
                        <label for="floatingInput">Credit Hours</label>
                    </div>
                    <div class="form-floating mb-4">
                        <select class="form-select" id="floatingSelectGrid" name="semester" required>
                            <option value="" disabled selected>--- Select Semester ---</option>
                            <option value="Spring">Spring</option>
                            <option value="Summer">Summer</option>
                            <option value="Fall">Fall</option>
                        </select>
                        <label for="floatingSelectGrid" class="fw-bold">Semester</label>
                    </div>

                    <div class="form-floating mb-4">
                        <select class="form-select" id="floatingSelectGrid" name="instructor_id" required>
                            <option value="" disabled selected>--- Select Instructor ---</option>
                            {% for instructor in instructors %}
                            <option value="{{ instructor.instructor_id }}">{{ instructor.full_name }}</option>
                            {% endfor %}
                        </select>
                        <label for="floatingSelectGrid" class="fw-bold">Instructor</label>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button class="btn btn-primary" type="submit">Add</button>
                </div>
            </div>
        </div>
    </div>
</form>

<!-- Update Course Modal -->
<form method="POST" action="{{ url_for('programs.updatecourse', program_id=program.program_id )}}">
    <div class="modal fade" id="UpdateModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Edit Course</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-floating mb-4">
                        <input type="number" class="form-control" id="modal-course-id" name="course_id"
                            placeholder="name@example.com" readonly>
                        <label for="floatingInput">Course ID</label>
                    </div>
                    <div class="form-floating mb-4">
                        <input type="number" class="form-control" id="floatingInput" name="credit_hours"
                            placeholder="name@example.com" required>
                        <label for="floatingInput">Credit Hours</label>
                    </div>
                    <div class="form-floating mb-4">
                        <select class="form-select" id="floatingSelectGrid" name="semester" required>
                            <option value="" disabled selected>--- Select Semester ---</option>
                            <option value="Spring">Spring</option>
                            <option value="Summer">Summer</option>
                            <option value="Fall">Fall</option>
                        </select>
                        <label for="floatingSelectGrid" class="fw-bold">Semester</label>
                    </div>

                    <div class="form-floating mb-4">
                        <select class="form-select" id="floatingSelectGrid" name="instructor_id" required>
                            <option value="" disabled selected>--- Select Instructor ---</option>
                            {% for instructor in instructors %}
                            <option value="{{ instructor.instructor_id }}">{{ instructor.full_name }}</option>
                            {% endfor %}
                        </select>
                        <label for="floatingSelectGrid" class="fw-bold">Instructor</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Change</button>
                </div>
            </div>
        </div>
    </div>
</form>

<script>
    const exampleModal = document.getElementById('UpdateModal')
    if (exampleModal) {
        exampleModal.addEventListener('show.bs.modal', event => {
            const button = event.relatedTarget
            const courseId = button.getAttribute('data-bs-course-id')

            exampleModal.querySelector('#modal-course-id').value = courseId
        })
    }
</script>

{% endblock %}